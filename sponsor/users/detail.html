<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ユーザ詳細 | LEADCAST</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
        }

        /* ヘッダー・サイドバー基本レイアウト */
        .header-container, .sidebar-container {
            position: relative;
            z-index: 1000;
        }

        /* メインコンテンツのレイアウト調整 */
        .main-content {
            margin-left: 250px;
            margin-top: 70px;
            padding: 30px;
            min-height: calc(100vh - 70px);
            transition: margin-left 0.3s ease;
        }

        .main-content.sidebar-collapsed {
            margin-left: 50px;
        }

        /* レスポンシブ対応 */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 0;
                margin-top: 70px;
            }
        }

        /* ナビゲーション */
        .breadcrumb {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #718096;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .breadcrumb a {
            color: #007acc;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* ユーザ情報セクション */
        .user-profile-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .user-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .user-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #007acc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: 700;
        }

        .user-basic-info h1 {
            font-size: 28px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .user-basic-info p {
            font-size: 16px;
            color: #718096;
            margin-bottom: 4px;
        }

        .user-status-badges {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-inactive {
            background: #fed7d7;
            color: #c53030;
        }

        .role-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-admin {
            background: #e6fffa;
            color: #234e52;
        }

        .role-manager {
            background: #e0e7ff;
            color: #3730a3;
        }

        .role-user {
            background: #f0f9ff;
            color: #0c4a6e;
        }

        .user-actions {
            margin-left: auto;
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #007acc;
            color: white;
        }

        .btn-primary:hover {
            background: #005999;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 122, 204, 0.3);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .btn-danger {
            background: #fed7d7;
            color: #c53030;
            border: 2px solid #feb2b2;
        }

        .btn-danger:hover {
            background: #fbb6b6;
            border-color: #f56565;
        }

        /* 詳細情報グリッド */
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .detail-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-group {
            margin-bottom: 20px;
        }

        .info-group:last-child {
            margin-bottom: 0;
        }

        .info-label {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 6px;
        }

        .info-value {
            font-size: 16px;
            color: #2d3748;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .editable-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .edit-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin-right: 10px;
        }

        .edit-input:focus {
            outline: none;
            border-color: #007acc;
        }

        .edit-btn {
            padding: 6px 12px;
            background: #e0e7ff;
            color: #3730a3;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .save-btn {
            background: #c6f6d5;
            color: #22543d;
        }

        /* 権限設定 */
        .permission-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .permission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .permission-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .permission-info p {
            font-size: 12px;
            color: #718096;
        }

        .permission-toggle {
            width: 48px;
            height: 24px;
            background: #cbd5e0;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .permission-toggle.active {
            background: #007acc;
        }

        .permission-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .permission-toggle.active::after {
            transform: translateX(24px);
        }

        /* アクティビティログ */
        .activity-log {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 16px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e7ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #3730a3;
        }

        .activity-content h4 {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .activity-content p {
            font-size: 12px;
            color: #718096;
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 11px;
            color: #a0aec0;
        }

        /* レスポンシブ */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .details-grid {
                grid-template-columns: 1fr;
            }

            .user-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-actions {
                margin-left: 0;
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .user-header {
                text-align: center;
                align-items: center;
            }

            .user-actions {
                flex-direction: column;
            }

            .btn {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 15px;
            }

            .user-profile-section,
            .detail-card,
            .activity-log {
                padding: 20px;
            }

            .user-avatar-large {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }

            .user-basic-info h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- ヘッダー -->
    <div id="header-container"></div>

    <!-- サイドバー -->
    <div id="sidebar-container"></div>

    <!-- メインコンテンツ -->
    <main class="main-content" id="mainContent">
        <!-- パンくずナビ -->
        <div class="breadcrumb">
            <a href="index.html">👥 ユーザ管理</a> › <span id="breadcrumbUser">田中 太郎</span>
        </div>

        <!-- ユーザプロフィール -->
        <div class="user-profile-section">
            <div class="user-header">
                <div class="user-avatar-large" id="userAvatar">田</div>
                <div class="user-basic-info">
                    <h1 id="userName">田中 太郎</h1>
                    <p id="userEmail">tanaka@company.com</p>
                    <p>ユーザID: <span id="userId">#001</span></p>
                    <div class="user-status-badges">
                        <span class="status-badge status-active" id="statusBadge">アクティブ</span>
                        <span class="role-badge role-admin" id="roleBadge">管理者</span>
                    </div>
                </div>
                <div class="user-actions">
                    <button class="btn btn-primary" onclick="editUser()">
                        <span>✏️</span>
                        <span>編集</span>
                    </button>
                    <button class="btn btn-secondary" onclick="resetPassword()">
                        <span>🔐</span>
                        <span>パスワードリセット</span>
                    </button>
                    <button class="btn btn-danger" onclick="deactivateUser()">
                        <span>⏸️</span>
                        <span>無効化</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 詳細情報 -->
        <div class="details-grid">
            <!-- 基本情報 -->
            <div class="detail-card">
                <h3 class="card-title">👤 基本情報</h3>
                
                <div class="info-group">
                    <div class="info-label">氏名</div>
                    <div class="info-value editable-field" id="nameField">
                        <span>田中 太郎</span>
                        <button class="edit-btn" onclick="editField('name')">編集</button>
                    </div>
                </div>

                <div class="info-group">
                    <div class="info-label">メールアドレス</div>
                    <div class="info-value editable-field" id="emailField">
                        <span>tanaka@company.com</span>
                        <button class="edit-btn" onclick="editField('email')">編集</button>
                    </div>
                </div>

                <div class="info-group">
                    <div class="info-label">電話番号</div>
                    <div class="info-value editable-field" id="phoneField">
                        <span>090-1234-5678</span>
                        <button class="edit-btn" onclick="editField('phone')">編集</button>
                    </div>
                </div>

                <div class="info-group">
                    <div class="info-label">部署</div>
                    <div class="info-value editable-field" id="departmentField">
                        <span>マーケティング部</span>
                        <button class="edit-btn" onclick="editField('department')">編集</button>
                    </div>
                </div>

                <div class="info-group">
                    <div class="info-label">役職</div>
                    <div class="info-value editable-field" id="positionField">
                        <span>部長</span>
                        <button class="edit-btn" onclick="editField('position')">編集</button>
                    </div>
                </div>
            </div>

            <!-- アカウント情報 -->
            <div class="detail-card">
                <h3 class="card-title">🔧 アカウント情報</h3>
                
                <div class="info-group">
                    <div class="info-label">登録日</div>
                    <div class="info-value">2024年1月15日</div>
                </div>

                <div class="info-group">
                    <div class="info-label">最終ログイン</div>
                    <div class="info-value">2024年8月29日 14:30</div>
                </div>

                <div class="info-group">
                    <div class="info-label">ログイン回数</div>
                    <div class="info-value">1,247回</div>
                </div>

                <div class="info-group">
                    <div class="info-label">2段階認証</div>
                    <div class="info-value">
                        <span style="color: #22543d;">✅ 有効</span>
                    </div>
                </div>

                <div class="info-group">
                    <div class="info-label">パスワード最終変更</div>
                    <div class="info-value">2024年7月20日</div>
                </div>
            </div>
        </div>

        <!-- 権限設定 -->
        <div class="detail-card">
            <h3 class="card-title">🔐 権限設定</h3>
            <div class="permission-list">
                <div class="permission-item">
                    <div class="permission-info">
                        <h4>ユーザ管理</h4>
                        <p>ユーザの作成、編集、削除権限</p>
                    </div>
                    <div class="permission-toggle active" onclick="togglePermission(this)"></div>
                </div>

                <div class="permission-item">
                    <div class="permission-info">
                        <h4>プロジェクト管理</h4>
                        <p>プロジェクトの作成、編集、削除権限</p>
                    </div>
                    <div class="permission-toggle active" onclick="togglePermission(this)"></div>
                </div>

                <div class="permission-item">
                    <div class="permission-info">
                        <h4>請求管理</h4>
                        <p>請求書の閲覧、ダウンロード権限</p>
                    </div>
                    <div class="permission-toggle" onclick="togglePermission(this)"></div>
                </div>

                <div class="permission-item">
                    <div class="permission-info">
                        <h4>レポート閲覧</h4>
                        <p>各種レポートの閲覧権限</p>
                    </div>
                    <div class="permission-toggle active" onclick="togglePermission(this)"></div>
                </div>

                <div class="permission-item">
                    <div class="permission-info">
                        <h4>システム設定</h4>
                        <p>システム全体の設定変更権限</p>
                    </div>
                    <div class="permission-toggle active" onclick="togglePermission(this)"></div>
                </div>
            </div>
        </div>

        <!-- アクティビティログ -->
        <div class="activity-log">
            <h3 class="card-title">📊 アクティビティログ</h3>
            
            <div class="activity-item">
                <div class="activity-icon">🔐</div>
                <div class="activity-content">
                    <h4>ログイン</h4>
                    <p>IP: 192.168.1.100 (東京)</p>
                    <div class="activity-time">2024年8月29日 14:30</div>
                </div>
            </div>

            <div class="activity-item">
                <div class="activity-icon">👥</div>
                <div class="activity-content">
                    <h4>ユーザ作成</h4>
                    <p>新規ユーザ「佐藤 花子」を作成</p>
                    <div class="activity-time">2024年8月29日 10:15</div>
                </div>
            </div>

            <div class="activity-item">
                <div class="activity-icon">📊</div>
                <div class="activity-content">
                    <h4>レポート出力</h4>
                    <p>月次売上レポートをダウンロード</p>
                    <div class="activity-time">2024年8月28日 16:45</div>
                </div>
            </div>

            <div class="activity-item">
                <div class="activity-icon">⚙️</div>
                <div class="activity-content">
                    <h4>設定変更</h4>
                    <p>通知設定を更新</p>
                    <div class="activity-time">2024年8月28日 11:20</div>
                </div>
            </div>

            <div class="activity-item">
                <div class="activity-icon">🔐</div>
                <div class="activity-content">
                    <h4>ログイン</h4>
                    <p>IP: 192.168.1.100 (東京)</p>
                    <div class="activity-time">2024年8月28日 09:30</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // URLパラメータを取得
        function getUrlParameters() {
            const params = new URLSearchParams(window.location.search);
            return {
                id: params.get('id'),
                isNew: params.get('new') === 'true',
                isEdit: params.get('edit') === 'true'
            };
        }

        // ユーザデータ（実際はAPIから取得）
        const userData = {
            '001': {
                id: '001',
                name: '田中 太郎',
                email: 'tanaka@company.com',
                phone: '090-1234-5678',
                department: 'マーケティング部',
                position: '部長',
                role: 'admin',
                status: 'active',
                joinDate: '2024-01-15',
                lastLogin: '2024-08-29 14:30'
            },
            '002': {
                id: '002',
                name: '佐藤 花子',
                email: 'sato@company.com',
                phone: '090-2345-6789',
                department: '営業部',
                position: '課長',
                role: 'manager',
                status: 'active',
                joinDate: '2024-02-20',
                lastLogin: '2024-08-29 09:15'
            }
        };

        // コンポーネント読み込み
        // コンポーネント読み込み
        async function loadComponents() {
            try {
                // ヘッダーを読み込み
                const headerResponse = await fetch('/sponsor/components/header.html');
                const headerHTML = await headerResponse.text();
                document.getElementById('header-container').innerHTML = headerHTML;

                // サイドバーを読み込み
                const sidebarResponse = await fetch('/sponsor/components/sidebar.html');
                const sidebarHTML = await sidebarResponse.text();
                document.getElementById('sidebar-container').innerHTML = sidebarHTML;

                // ユーザ管理がアクティブになるようにサイドバーを更新
                setTimeout(() => {
                    updateSidebarActive();
                }, 100);
            } catch (error) {
                console.error('コンポーネントの読み込みエラー:', error);
            }
        }

        function updateSidebarActive() {
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            sidebarItems.forEach(item => {
                item.classList.remove('active');
                if (item.href && item.href.includes('users.html')) {
                    item.classList.add('active');
                }
            });
        }

        // ユーザ情報を読み込み
        function loadUserData() {
            const params = getUrlParameters();
            const user = userData[params.id] || userData['001'];

            document.getElementById('breadcrumbUser').textContent = user.name;
            document.getElementById('userAvatar').textContent = user.name.charAt(0);
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userId').textContent = `#${user.id}`;

            // ステータスバッジ更新
            const statusBadge = document.getElementById('statusBadge');
            statusBadge.className = `status-badge status-${user.status}`;
            statusBadge.textContent = user.status === 'active' ? 'アクティブ' : '非アクティブ';

            // ロールバッジ更新
            const roleBadge = document.getElementById('roleBadge');
            roleBadge.className = `role-badge role-${user.role}`;
            const roleLabels = {
                'admin': '管理者',
                'manager': 'マネージャー',
                'user': '一般ユーザ'
            };
            roleBadge.textContent = roleLabels[user.role];

            // 基本情報フィールド更新
            updateField('nameField', user.name);
            updateField('emailField', user.email);
            updateField('phoneField', user.phone);
            updateField('departmentField', user.department);
            updateField('positionField', user.position);
        }

        function updateField(fieldId, value) {
            const field = document.getElementById(fieldId);
            if (field) {
                const span = field.querySelector('span');
                if (span) span.textContent = value;
            }
        }

        // フィールド編集
        function editField(fieldType) {
            const fieldMapping = {
                'name': 'nameField',
                'email': 'emailField',
                'phone': 'phoneField',
                'department': 'departmentField',
                'position': 'positionField'
            };

            const fieldId = fieldMapping[fieldType];
            const field = document.getElementById(fieldId);
            const span = field.querySelector('span');
            const button = field.querySelector('button');
            const currentValue = span.textContent;

            // 編集モードに切り替え
            span.style.display = 'none';
            button.textContent = '保存';
            button.className = 'edit-btn save-btn';

            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.className = 'edit-input';
            field.insertBefore(input, button);

            button.onclick = () => saveField(fieldId, fieldType, input.value);
        }

        function saveField(fieldId, fieldType, newValue) {
            const field = document.getElementById(fieldId);
            const span = field.querySelector('span');
            const button = field.querySelector('button');
            const input = field.querySelector('input');

            // 値を更新
            span.textContent = newValue;
            span.style.display = '';

            // 編集モードを終了
            input.remove();
            button.textContent = '編集';
            button.className = 'edit-btn';
            button.onclick = () => editField(fieldType);

            alert(`${fieldType}を「${newValue}」に更新しました`);
        }

        // 権限切り替え
        function togglePermission(toggle) {
            toggle.classList.toggle('active');
        }

        // ユーザアクション
        function editUser() {
            alert('ユーザ情報の編集モードに切り替えます');
        }

        function resetPassword() {
            if (confirm('このユーザのパスワードをリセットしますか？')) {
                alert('パスワードリセットメールを送信しました');
            }
        }

        function deactivateUser() {
            if (confirm('このユーザを無効化しますか？')) {
                alert('ユーザを無効化しました');
                
                // ステータス更新
                const statusBadge = document.getElementById('statusBadge');
                statusBadge.className = 'status-badge status-inactive';
                statusBadge.textContent = '非アクティブ';
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            loadComponents(); // コンポーネントを読み込み
            loadUserData();
        });
    </script>
</body>
</html>
